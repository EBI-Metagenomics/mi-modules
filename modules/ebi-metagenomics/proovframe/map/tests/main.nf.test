nextflow_process {

    name "Test Process PROOVFRAME_MAP"
    script "../main.nf"
    process "PROOVFRAME_MAP"

    tag "modules"
    tag "modules_nfcore"
    tag "proovframe/map"
    tag: "proovframe"

    test("test - faa_fasta") {

        when {
            process {
                """
                input[0] = [
                    [ id:'test', single_end:false ], // meta map
                    file("${moduleDir}/tests/fixtures/emales.faa", checkIfExists: true),
                    file("${moduleDir}/tests/fixtures/emales-reads-sim.fa", checkIfExists: true),
                ]
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert path(process.out.tsv[0][1]).text.contains('EMALE01_Cflag_c017B	EMALE01_Cflag_c017B_0005	73.5	646	154	12	1803	3727	7	642	1.02e-244	749	21173	65M1D39M2I7M1\75M1\85M1\11M1I1\11M1\6M4I37M1\10M1/7M1/3M1/11M1D40M1/4M1I11M1\4M1\33M1D9M1\6M1\8M1I8M1D31M1\18M1\6M1D9M1I11M2D64M	EIFSLKLLNSYLQKVTSDNDKNLVNAKEYIRKYFFPTTKGIFFYNGEPDSRHFELIQMKNLTTRYISNDLKAYKIETDEREGADGTVITKTKKRLCFDAIKFMQSTAFLQNKIYLVTINPHIFSRTFKKDDMDYLNMMKPRLHQPHKVKKFDTYPEDVKKGVNVMLNHIRIVWANDQESMYNYMINWLVSCTIMGRKLRTLLYLQSTERTGKSIVIDFIQKYVLGPHTTHVTSSLEEIDKWTKPLEGRMLVNFNELPCAGMNQWRGIMDALKSLCVTEQYFSVTQRIYCDSYSQRNTFTNIIVTSNNNAINVSVNNHARIVSADVSEARLGDLGYFTEFKKQYISRSDVGEAFLFAYMKEHLFETRTGKFFNCDMKPTTESMRDKIASNLPSYVDFIKANFIKEKVDIENTTDDFYTDKYNVYCSEQKLRPLKKRAMLG*THLKKLGITKVRRLVSGERFHYYVANYKDLLSLFTKKLWIHDTLDDIDDERDDKHESDLEKKLSVMTXXXXXXXXXXXXXXXXXXXXXXXXXXLVSDINREYKVLVKTEREHYENACNARIDVVESLNKKLNKEKEDLIQTVTDVNETPEIEKRVDDGLDDDDAFDMIGSDDEPETAPTDKKSDETQEEEQVCKKLMSQMKKKKRVKRTKVN	26LK12SG1PF3VG2YD16-I22KT14RQASG-L-LTLA5\-4TISNTPLH1YFFSQRHTVFHK1GDEDWMYD1HLMNKMNM*KAPGRSL1HQRP3EK14EV8GWLAMNHD1QE10\-21*G51GQ4IM6\-11P-\-6HQ3LF\-HN3FTGSL-C-H-F-35SKKQ\-2VR7/-4EK1YH/-3/-ST3SF4QK1-T1*EISHMERND1LISA1LN3CY25/-QY2DY*-HC6LPSLGK1\-4\-DT*HFL3SGLIKTGK*VLRKRTLSVLSRG*E4LY2KN1LK3*S1-F1*K3TIFHTD1\-YD5\-4PECSIDILT-DE7-XKXDXIXVXEXNXMXRXEXEXIXRXRXWXSXRXTXIXSXEXKXRXCXTXWXILGV4\-12HY5\-6-SIL2RK5G-RESDYLRI2AV3QN-E-T*PHELIYERK1EV*D7CA2AM1DGPSIDVDKELP1ST24FK11') },
                { assert snapshot(process.out.versions).match() }
            )
        }
    }


    test("test - faa_fasta - stub") {
        options '-stub'

        when {
            process {
                """
                input[0] = [
                    [ id:'test', single_end:false ], // meta map
                    file("${moduleDir}/tests/fixtures/emales.faa", checkIfExists: true),
                    file("${moduleDir}/tests/fixtures/emales-reads-sim.fa", checkIfExists: true),
                ]
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out).match() }
            )
        }
    }
}
